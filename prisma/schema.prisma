generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  MANAGER
  EMPLOYEE
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String?
  password  String?
  role      Role     @default(EMPLOYEE)
  image     String?
  username  String?  @unique
  createdAt DateTime @default(now())

  notifications Notification[]
  consignments  Consignment[]
}

model Notification {
  id        String    @id @default(uuid())
  userId    String
  title     String
  message   String
  type      String // เช่น ORDER, PAYMENT, SYSTEM
  isSent    Boolean   @default(false)
  sentAt    DateTime?
  createdAt DateTime  @default(now())

  user User @relation(fields: [userId], references: [id])
}

model Consignment {
  id            String   @id @default(uuid())
  date          DateTime
  lot           String
  consignorName String
  contactNumber String
  address       String
  totalPrice    Float
  type          String   @default("INCOME")
  createdAt     DateTime @default(now())

  userId String? // ✅ Tracking owner
  user   User?   @relation(fields: [userId], references: [id])

  images ConsignmentImage[]
  items  ConsignmentItem[]
}

model ConsignmentImage {
  id            String      @id @default(uuid())
  imageUrl      String
  consignmentId String
  consignment   Consignment @relation(fields: [consignmentId], references: [id])
}

model ConsignmentItem {
  id             String      @id @default(uuid())
  productName    String
  category       String
  year           String
  status         String
  confirmedPrice Float
  salesChannel   String
  imageUrl       String?
  slipImage      String? // ✅ เพิ่ม
  soldAt         DateTime?
  consignmentId  String
  consignment    Consignment @relation(fields: [consignmentId], references: [id])
}

model ShopProfile {
  id          String   @id @default("default")
  shopName    String   @default("-")
  address     String   @default("-")
  subDistrict String   @default("-")
  district    String   @default("-")
  province    String   @default("-")
  zipCode     String   @default("-")
  line        String?
  shopee      String?
  facebook    String?
  phone       String?
  updatedAt   DateTime @updatedAt
}

model ImportStatus {
  id       Int       @id @default(autoincrement())
  name     String
  products Product[]

  createdAt DateTime @default(now())
}

model Product {
  id   Int    @id @default(autoincrement())
  name String

  // สถานะนำเข้า
  importStatusId Int
  importStatus   ImportStatus @relation(fields: [importStatusId], references: [id])

  // สถานะการเบิกจ่าย
  payoutStatusId Int?
  payoutStatus   PayoutStatus? @relation(fields: [payoutStatusId], references: [id])

  // สถานะขายจริง
  isSold Boolean   @default(false)
  soldAt DateTime?

  // New fields for extended status tracking
  status       String   @default("ready") // ready, reserved, repair, sold
  images       String[] // Array of image URLs
  defectImages String[] // Array of defect image URLs
  slipImage    String? // URL of payment slip

  createdAt DateTime @default(now())
}

model PayoutStatus {
  id        Int       @id @default(autoincrement())
  name      String
  products  Product[]
  createdAt DateTime  @default(now())
}
