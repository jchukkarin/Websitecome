generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x", "debian-openssl-3.0.x", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id                   String         @id @default(uuid())
  name                 String?
  email                String         @unique
  password             String?
  createdAt            DateTime       @default(now())
  image                String?
  username             String?        @unique
  role                 Role           @default(EMPLOYEE)
  consignments         Consignment[]  @relation("Creator")
  receivedConsignments Consignment[]  @relation("Receiver")
  lots                 Lot[]
  notifications        Notification[]
}

model Notification {
  id        String    @id @default(uuid())
  userId    String
  title     String
  message   String
  type      String
  isSent    Boolean   @default(false)
  sentAt    DateTime?
  createdAt DateTime  @default(now())
  user      User      @relation(fields: [userId], references: [id])
}

model Consignment {
  id            String   @id @default(uuid())
  date          DateTime
  lot           String
  consignorName String
  contactNumber String
  address       String
  totalPrice    Float
  createdAt     DateTime @default(now())
  type          String   @default("INCOME")

  userId String?
  user   User?   @relation("Creator", fields: [userId], references: [id])

  receiverId String?
  receiver   User?   @relation("Receiver", fields: [receiverId], references: [id])

  endDate DateTime?

  statusId Int?
  status   ConsignmentStatus? @relation(fields: [statusId], references: [id])

  images ConsignmentImage[]
  items  ConsignmentItem[]

  lotId       String?
  lotRelation Lot?    @relation(fields: [lotId], references: [id])
}

model Lot {
  id           String        @id @default(uuid())
  lotNumber    String        @unique
  consignments Consignment[]
  userId       String?
  user         User?         @relation(fields: [userId], references: [id])
  createdAt    DateTime      @default(now())
}

model ConsignmentStatus {
  id           Int           @id @default(autoincrement())
  name         String        @unique
  consignments Consignment[]
}

model ConsignmentImage {
  id            String      @id @default(uuid())
  imageUrl      String
  consignmentId String
  consignment   Consignment @relation(fields: [consignmentId], references: [id])
}

model ConsignmentItem {
  id               String      @id @default(uuid())
  productName      String
  category         String
  year             String
  status           String      @default("ready")
  confirmedPrice   Float       @default(0)
  salesChannel     String?
  imageUrl         String?
  consignmentId    String
  slipImage        String?
  soldAt           DateTime?
  isReserveOpen    String?     @default("false")
  repairStatus     String      @default("NOT_REPAIR")
  reserveDays      String?
  reserveEndDate   String?
  reserveStartDate String?
  salesPrice       Float?      @default(0)
  redemptionPrice  Float?      @default(0)
  repairEndDate    DateTime?
  repairStartDate  DateTime?
  consignment      Consignment @relation(fields: [consignmentId], references: [id])
}

model Counter {
  id    String @id
  value Int    @default(0)
}

model LotCounter {
  id      Int @id @default(autoincrement())
  year    Int
  counter Int @default(0)

  @@unique([year])
}

model ShopProfile {
  id          String   @id @default("default")
  shopName    String   @default("-")
  address     String   @default("-")
  subDistrict String   @default("-")
  district    String   @default("-")
  province    String   @default("-")
  zipCode     String   @default("-")
  line        String?
  shopee      String?
  facebook    String?
  phone       String?
  updatedAt   DateTime @updatedAt
}

model ImportStatus {
  id        Int       @id @default(autoincrement())
  name      String
  createdAt DateTime  @default(now())
  products  Product[]
}

model Product {
  id             Int           @id @default(autoincrement())
  name           String
  importStatusId Int
  createdAt      DateTime      @default(now())
  isSold         Boolean       @default(false)
  payoutStatusId Int?
  soldAt         DateTime?
  defectImages   String[]
  images         String[]
  slipImage      String?
  status         String        @default("ready")
  importStatus   ImportStatus  @relation(fields: [importStatusId], references: [id])
  payoutStatus   PayoutStatus? @relation(fields: [payoutStatusId], references: [id])
}

model PayoutStatus {
  id        Int       @id @default(autoincrement())
  name      String
  createdAt DateTime  @default(now())
  products  Product[]
}

enum Role {
  MANAGER
  EMPLOYEE
}

enum RepairStatus {
  NOT_REPAIR
  REPAIRING
  REPAIRED
  RETURN_CUSTOMER
}
